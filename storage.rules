rules_version = '2';

/**
 * Firebase Storage Security Rules for IDMC Conference
 *
 * Storage paths:
 * - conference/hero-images/{filename} - Hero images for the conference
 * - conference/hero-videos/{filename} - Hero videos for the conference
 * - speakers/photos/{speakerId}/{filename} - Speaker profile photos
 */
service firebase.storage {
  match /b/{bucket}/o {
    // Helper function to check if user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }

    // Helper function to validate image file
    function isValidImage() {
      return request.resource.contentType.matches('image/.*')
        && request.resource.size < 10 * 1024 * 1024; // 10MB max
    }

    // Helper function to validate video file
    function isValidVideo() {
      return request.resource.contentType.matches('video/.*')
        && request.resource.size < 100 * 1024 * 1024; // 100MB max
    }

    // Conference hero images
    match /conference/hero-images/{fileName} {
      allow read: if true; // Public read access
      allow write: if isAuthenticated() && isValidImage();
    }

    // Conference hero videos
    match /conference/hero-videos/{fileName} {
      allow read: if true; // Public read access
      allow write: if isAuthenticated() && isValidVideo();
    }

    // Speaker photos
    match /speakers/photos/{speakerId}/{fileName} {
      allow read: if true; // Public read access
      allow write: if isAuthenticated() && isValidImage();
    }

    // Helper function to validate payment proof file (image or PDF)
    function isValidPaymentProof() {
      return (request.resource.contentType.matches('image/.*') || request.resource.contentType == 'application/pdf')
        && request.resource.size < 5 * 1024 * 1024; // 5MB max
    }

    // Registration payment proofs - allows public uploads since users register without auth
    match /registrations/payment-proofs/{registrationId}/{fileName} {
      allow read: if true; // Public read access for admin verification
      allow write: if isValidPaymentProof();
    }
  }
}
